<!-- Project Modal (Create/Edit) with Transparent Background -->
<div *ngIf="isOpen" class="fixed inset-0 z-50 flex items-center justify-center p-4"
    style="background: rgba(0, 0, 0, 0.1);">
    <div class="bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-gray-300"
        style="backdrop-filter: blur(2px); scrollbar-width: none; -ms-overflow-style: none;">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-white">
            <h2 class="text-xl font-semibold text-gray-900">
                {{ mode === 'edit' ? 'Edit Project' : 'Create New Project' }}
            </h2>
            <button (click)="onClose()" class="text-gray-400 hover:text-gray-600 transition-colors duration-200"
                type="button">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>
        </div>
        <form [formGroup]="projectForm" class="p-6 space-y-6 bg-white" novalidate>
            <!-- Title -->
            <div>
                <label for="projectTitle" class="block text-sm font-medium text-gray-700 mb-1">
                    Project Title *
                </label>
                <input id="projectTitle" type="text" formControlName="projectTitle"
                    placeholder="e.g., Portfolio Website"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent"
                    [class.border-red-500]="hasFormError('projectTitle')" />
                <div *ngIf="hasFormError('projectTitle')" class="mt-1 text-sm text-red-600">
                    Title is required
                </div>
            </div>
            <!-- Description -->
            <div>
                <label for="projectDescription" class="block text-sm font-medium text-gray-700 mb-1">
                    Description
                </label>
                <textarea id="projectDescription" formControlName="projectDescription" rows="3"
                    placeholder="Describe your project..."
                    class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent"></textarea>
            </div>
            <!-- Thumbnail -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Project Thumbnail
                </label>
                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-gray-400 transition-colors"
                    (click)="fileInput.click()">
                    <div class="space-y-1 text-center">
                        <div *ngIf="imagePreview || projectForm.get('thumbnail')?.value" class="mb-4">
                            <img [src]="imagePreview || projectForm.get('thumbnail')?.value" alt="Preview"
                                class="mx-auto h-32 w-auto rounded-md" />
                        </div>
                        <svg *ngIf="!imagePreview && !projectForm.get('thumbnail')?.value"
                            class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none"
                            viewBox="0 0 48 48">
                            <path
                                d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <div class="flex text-sm text-gray-600 justify-center">
                            <span class="font-medium text-slate-600">{{ imagePreview ||
                                projectForm.get('thumbnail')?.value ? 'Change image' : 'Upload a file' }}</span>
                        </div>
                        <input #fileInput type="file" class="hidden" accept="image/*" (change)="onFileChange($event)" />
                        <p class="text-xs text-gray-500">PNG/JPG up to 5MB</p>
                    </div>
                </div>
            </div>
            <!-- Status & Dates -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="projectStatus" class="block text-sm font-medium text-gray-700 mb-1">
                        Status *
                    </label>
                    <select id="projectStatus" formControlName="projectStatus"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent"
                        [class.border-red-500]="hasFormError('projectStatus')">
                        <option value="">Select status</option>
                        <option value="Not Started">Not Started</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                    </select>
                    <div *ngIf="hasFormError('projectStatus')" class="mt-1 text-sm text-red-600">
                        Status is required
                    </div>
                </div>
                <div>
                    <label for="projectStartedDate" class="block text-sm font-medium text-gray-700 mb-1">
                        Start Date
                    </label>
                    <input id="projectStartedDate" type="date" formControlName="projectStartedDate"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent" />
                </div>
                <div>
                    <label for="projectFinishedDate" class="block text-sm font-medium text-gray-700 mb-1">
                        Finish Date
                    </label>
                    <input id="projectFinishedDate" type="date" formControlName="projectFinishedDate"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent" />
                </div>
            </div>
            <!-- URLs -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="projectGithubURL" class="block text-sm font-medium text-gray-700 mb-1">
                        GitHub URL
                    </label>
                    <input id="projectGithubURL" type="url" formControlName="projectGithubURL"
                        placeholder="https://github.com/username/repo"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent" />
                </div>
                <div>
                    <label for="projectLiveURL" class="block text-sm font-medium text-gray-700 mb-1">
                        Live URL
                    </label>
                    <input id="projectLiveURL" type="url" formControlName="projectLiveURL"
                        placeholder="https://example.com"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent" />
                </div>
            </div>
            <!-- Skills -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Related Skills
                </label>
                <div class="mt-2 space-y-2 max-h-32 overflow-y-auto border border-gray-300 rounded-md p-3">
                    <div *ngFor="let skill of availableSkills" class="flex items-center">
                        <input [id]="'skill-' + skill.id" type="checkbox"
                            [checked]="selectedSkillIds.includes(skill.id)" (change)="toggleSkill(skill.id)"
                            class="h-4 w-4 text-slate-600 focus:ring-slate-500 border-gray-300 rounded" />
                        <label [for]="'skill-' + skill.id" class="ml-2 text-sm text-gray-900">
                            {{ skill.skillName }} ({{ skill.skillCategory }})
                        </label>
                    </div>
                    <div *ngIf="availableSkills.length === 0" class="text-sm text-gray-500 text-center py-2">
                        No skills available. Add some skills first.
                    </div>
                </div>
            </div>
        </form>
        <div class="flex items-center justify-end space-x-3 px-6 py-4 border-t border-gray-200 bg-white">
            <button type="button" (click)="onClose()"
                class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors duration-200">
                Cancel
            </button>
            <button type="button" (click)="onSubmit()" [disabled]="projectForm.invalid || isFormLoading"
                class="px-4 py-2 bg-slate-800 text-white rounded-md text-sm font-medium hover:bg-slate-900 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center">
                <div *ngIf="isFormLoading" class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                {{ mode === 'edit' ? 'Update' : 'Save' }}
            </button>
        </div>
    </div>
</div>